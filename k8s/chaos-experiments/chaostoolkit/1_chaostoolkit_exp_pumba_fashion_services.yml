{
  "version": "1.0.0",
  "title": "Inject latency in a fashion pod",
  "description": "Inject latency via Pumba into a fashion pod",
  "tags": [
    "microservice",
    "kubernetes",
    "pumba"
  ],
  "steady-state-hypothesis": {
    "title": "Services are all available and healthy",
    "probes": [
    {
      "name": "api-gateway-must-still-respond",
      "provider": {
        "type": "http",
        "url": "http://gateway-HOSTPATTERN.chaos.codecentric.io/startpage/lb",
        "timeout": [0.25, 0.50]
      },
      "tolerance": 200,
      "type": "probe"
    }
    ]
  },
  "method": [
  {
    "type": "probe",
    "name": "all-services-are-healthy",
    "tolerance": true,
    "provider": {
      "type": "python",
      "module": "chaosk8s.probes",
      "func": "all_microservices_healthy",
      "arguments": {
        "ns": "shoppingdemo"
      }
    }
  },
  {
    "type": "action",
    "name": "deploy_pumba_as_daemon_set",
    "provider": {
      "type": "process",
      "path": "kubectl",
      "arguments":{
        "apply":"",
        "-f":"../pumba-inject-latency-all-fashion-services.yaml"
      }
    },
    "pauses": {
      "after": 5
    }
  },
  {
    "type": "probe",
    "name": "check-gateway-response",
    "provider": {
      "type": "process",
      "path": "ab",
      "timeout": 60,
      "arguments": {
        "-n": "500",
        "-c": "4",
        "-s": "1",
        "-g": "output.data",
        "https://gateway-HOSTPATTERN.chaos.codecentric.io/startpage/lb": ""
      }
    }
  }
  ],
  "rollbacks": [
  {
    "type": "action",
    "name": "delete_pumba_as_daemon_set",
    "provider": {
      "type": "process",
      "path": "kubectl",
      "arguments":{
        "delete":"",
        "-f":"../pumba-inject-latency-all-fashion-services.yaml"
      }
    }
  }
  ]
}